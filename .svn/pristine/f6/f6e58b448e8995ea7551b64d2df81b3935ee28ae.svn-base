<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="screenHomeMapper">
	<!-- 卡总数查询 -->
	<select id="getCountCard" parameterType="pd" resultType="pd">
				SELECT 
		CAST(count(*) AS SIGNED) as countCard,
		CAST(
		sum(CASE WHEN onlinestatus = 1 THEN 1 ELSE 0 END) AS SIGNED
		)AS nozaixian
		,
		CAST(
		sum(CASE WHEN onlinestatus = 0 THEN 1 ELSE 0 END) AS SIGNED
		)AS zaixian
		,
		CAST(sum(CASE WHEN used = 0 or used IS NULL THEN 1 ELSE 0 END) AS SIGNED)AS unUsedFlowNum,
		CAST(sum(CASE WHEN ismaxpkginfo =0 THEN 1 ELSE 0 END) AS SIGNED)AS chaoliu,
		CAST(sum(CASE WHEN operator=1 THEN 1 ELSE 0 END) AS SIGNED)AS ydnum,
		CAST(sum(CASE WHEN operator=2 THEN 1 ELSE 0 END) AS SIGNED)AS ltnum, 
		CAST(sum(CASE WHEN operator=3 THEN 1 ELSE 0 END) AS SIGNED)AS dxnum,
		CAST(sum(CASE WHEN businessstatus=2 THEN 1 ELSE 0 END) AS SIGNED)AS tingji,
	    CAST(sum(CASE WHEN businesstype=1 THEN 1 ELSE 0 END) AS SIGNED)AS pwnum,
		CAST(sum(CASE WHEN businesstype=2 THEN 1 ELSE 0 END) AS SIGNED)AS jlnum, 
		CAST(sum(CASE WHEN businesstype=3 THEN 1 ELSE 0 END) AS SIGNED)AS cdznum,
		CAST(sum(CASE WHEN businesstype=4 THEN 1 ELSE 0 END) AS SIGNED)AS sdjcnum,
		CAST(sum(CASE WHEN businesstype=5 THEN 1 ELSE 0 END) AS SIGNED)AS dynum,
		CAST(sum(CASE WHEN businesstype=6 THEN 1 ELSE 0 END) AS SIGNED)AS jcnum,
		CAST(sum(CASE WHEN businesstype=7 THEN 1 ELSE 0 END) AS SIGNED)AS fknum,
		CAST(sum(CASE WHEN businesstype=8 THEN 1 ELSE 0 END) AS SIGNED)AS pdnum
		FROM b_nc_card WHERE  delstatus='1' 
	</select>

	<!-- 获取设备告警数量（严重） -->
	<select id="selectSeriousWarningDatas" parameterType="pd" resultType="pd">
		SELECT 
			CAST(count(*) AS SIGNED) as totalWarningNum, 
			CAST(sum(CASE WHEN <![CDATA[snr < 9 or signalstrength < -100]]> THEN 1 ELSE 0 END) AS SIGNED) AS seriousStatusNum  
		FROM b_ct_warning_mld 
		WHERE 1 = 1 AND status = 0 ;
	</select>
	
	<!-- 获取设备告警数量（一般） -->
	<select id="selectGeneralWarningDatas" parameterType="pd" resultType="pd">
		SELECT 
			CAST(sum(CASE WHEN cpuused > 50 or memused > 80 or moduletemperature > 45 THEN 1 ELSE 0 END) AS SIGNED) AS generalStatusNum 
		FROM b_ct_warning_mld 
		WHERE 1 = 1 AND status = 0 and snr >= 9 and signalstrength >= -100;
	</select>
	
	<!-- 获取设备不告警数量 -->
	<select id="selectUnWarningDatas" parameterType="pd" resultType="pd">
		SELECT 
			CAST(count(*) AS SIGNED) as unWarningNum 
		FROM b_ct_warning_mld 
		WHERE 1 = 1 AND status = 1 
	</select>
	
	<!-- 获取设备不在线数量 -->
	<select id="selectOutLineDatas" parameterType="pd" resultType="pd">
		SELECT 
			CAST(count(*) AS SIGNED) as outLineNum 
		FROM b_ct_terminal 
		WHERE 1 = 1 AND status = 0 
	</select>

	<select id="selectEquipmentBusinesstypeCount" resultType="pd">
	  select
	 (select count(*) from b_ct_terminal) as total
	,(select count(*) from b_ct_terminal where businesstype=1) as peiwang
	,(select count(*) from b_ct_terminal where businesstype=2) as jiliang
	,(select count(*) from b_ct_terminal where businesstype=3) as cdz
	,(select count(*) from b_ct_terminal where businesstype=4) as sd
	,(select count(*) from b_ct_terminal where businesstype=5) as dy
	,(select count(*) from b_ct_terminal where businesstype=6) as jc
	,(select count(*) from b_ct_terminal where businesstype=7) as fc
	,(select count(*) from b_ct_terminal where businesstype=8) as pb

	</select>

	<!-- 获取各区设备不在线台数（实时）-->
	<select id="selectOutlineNumOfRegion" parameterType="pd" resultType="pd">
		SELECT t.dvalue as regionName,t.code as regionId, CAST(sum(CASE WHEN b.status = 0 or b.status IS NULL THEN 0 ELSE 1 END) AS SIGNED)AS onlineNum,
       		   CAST(sum(CASE WHEN b.status = 0 THEN 1 ELSE 0 END)  AS SIGNED) AS outlineNum 
		FROM b_ct_terminal b RIGHT JOIN t_system_dictionary t ON b.regionid = t.code 
		WHERE t.dgroup='region_type' 
		GROUP BY t.code;
	</select>
		<!-- 获取区域设备数-->
	<select id="selectTerminalNum" parameterType="pd" resultType="int">
		SELECT count(*) as termnum FROM b_ct_terminal where regionid=#{regionids}
	</select>
	<!-- 获取区域卡数-->
	<select id="selectCardNum" parameterType="pd" resultType="int">
		SELECT count(*) as cardnum FROM b_nc_card where regionid=#{regionids}
	</select>
	<!-- 获取区域告警数-->
	<select id="selectWarningMldNum" parameterType="pd" resultType="int">
		SELECT count(*) as warningnum  FROM b_ct_warning_mld where regionid=#{regionids}
	</select>
	<select id="selectFactorycodeGroup" parameterType="pd" resultType="pd">
		 SELECT count(a.factorycode)as codenum ,b.`code` ,b.dvalue
		 FROM b_ct_warning_mld a  RIGHT JOIN t_system_dictionary b
		 on a.factorycode = b.code and a.`status`=0
		 WHERE dgroup='factory_type' 
   		 GROUP BY b.code
	</select>
	<!-- 卡流量按运营商统计-->
	<select id="findCardFlowData" parameterType="pd" resultType="pd">
		select IFNULL(SUM(a.dayflow),0) dayflow,b.dvalue operator from r_cardflow_report a 
		right join t_system_dictionary b on a.operator=b.code and 
		date_format(collectdate,'%Y-%m-%d')
		<if test="regionid != null and regionid !=''">
			 and a.regionid= #{regionid}
		</if>
		<if test="yw_type != null and yw_type !=''">
			 and a.yw_type= #{yw_type}
		</if>		
		where b.dgroup='operator_type' 
		group by b.dvalue; 
	</select>
</mapper>

